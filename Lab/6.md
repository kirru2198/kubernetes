 Problem Statement:
 You have just joined a startup Ventura Software as a DevOps Lead Engineer. The company relies on a monolithic architecture for its products. Recently, the senior management was hired. The new CTO insists on having a microservice architecture. The development team is working on breaking the monolith. Meanwhile, you have been asked to host a test application on Kubernetes to understand how it works. Following things have to be implemented:
 
 1. Deploy an Apache2 deployment of 2 replicas
 2. Sample code has been checked-in at the following GitHub repo:
 https://github.com/hshar/website.git
 You have to containerize this code, and push it to Docker Hub. Once done, deploy it on Kubernetes with 2 replicas.
 
 3. Deploy ingress with the following rules:
 a. */apache* should point to the Apache pods
 b. */custom* should point to the GitHub application

---

Hereâ€™s a **detailed, step-by-step solution** to help you complete the assignment given by Ventura Software, covering **Apache deployment**, **containerizing a GitHub repo**, **pushing to Docker Hub**, and **Kubernetes Ingress routing**.

---

## ðŸ§¾ **Problem Statement Breakdown**

### âœ… 1. Deploy Apache with 2 replicas

### âœ… 2. Clone a GitHub repo, containerize it, push to Docker Hub, and deploy it with 2 replicas

### âœ… 3. Set up Ingress with 2 routing rules:

* `/apache` â†’ Apache service
* `/custom` â†’ Website from GitHub repo

---

## âœ… **Step 1: Apache2 Deployment with 2 Replicas**

### ðŸ”¹ Create Deployment YAML â€“ `apache-deployment.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apache-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: apache
  template:
    metadata:
      labels:
        app: apache
    spec:
      containers:
      - name: apache
        image: httpd:latest
        ports:
        - containerPort: 80
```

### ðŸ”¹ Create ClusterIP Service â€“ `apache-service.yaml`

```yaml
apiVersion: v1
kind: Service
metadata:
  name: apache-service
spec:
  selector:
    app: apache
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
```

### ðŸ”¹ Apply:

```bash
kubectl apply -f apache-deployment.yaml
kubectl apply -f apache-service.yaml
```

---

## âœ… **Step 2: Containerize the GitHub Application**

### ðŸ”¹ 1. Clone the GitHub Repo

```bash
git clone https://github.com/hshar/website.git
cd website
```

### ðŸ”¹ 2. Create a Dockerfile

Inside the `website/` folder, create a `Dockerfile`:

```Dockerfile
FROM httpd:2.4
COPY . /usr/local/apache2/htdocs/
```

### ðŸ”¹ 3. Build Docker Image

Replace `yourdockerhubusername` with your Docker Hub username:

```bash
docker build -t yourdockerhubusername/website-app .
```

### ðŸ”¹ 4. Login and Push to Docker Hub

```bash
docker login
docker push yourdockerhubusername/website-app
```

---

### ðŸ”¹ 5. Create Kubernetes Deployment â€“ `custom-deployment.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: custom-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: custom
  template:
    metadata:
      labels:
        app: custom
    spec:
      containers:
      - name: custom
        image: yourdockerhubusername/website-app
        ports:
        - containerPort: 80
```

### ðŸ”¹ 6. Create Service â€“ `custom-service.yaml`

```yaml
apiVersion: v1
kind: Service
metadata:
  name: custom-service
spec:
  selector:
    app: custom
  ports:
  - port: 80
    targetPort: 80
  type: ClusterIP
```

### ðŸ”¹ Apply:

```bash
kubectl apply -f custom-deployment.yaml
kubectl apply -f custom-service.yaml
```

---

## âœ… **Step 3: Configure Ingress Routing**

### ðŸ”¹ 1. Ensure Ingress Controller Is Installed

If using **Minikube**:

```bash
minikube addons enable ingress
```

Or deploy NGINX ingress manually if on bare metal or cloud.

---

### ðŸ”¹ 2. Create Ingress Resource â€“ `ingress.yaml`

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: test-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: local.test
    http:
      paths:
      - path: /apache
        pathType: Prefix
        backend:
          service:
            name: apache-service
            port:
              number: 80
      - path: /custom
        pathType: Prefix
        backend:
          service:
            name: custom-service
            port:
              number: 80
```

Apply it:

```bash
kubectl apply -f ingress.yaml
```

---

### ðŸ”¹ 3. Edit Your Hosts File

Edit `/etc/hosts` (Linux/macOS) or `C:\Windows\System32\drivers\etc\hosts` (Windows) and add:

```
<your-minikube-or-cluster-ip> local.test
```

To get IP (if using Minikube):

```bash
minikube ip
```

---

### ðŸ”¹ 4. Test in Browser

* Visit `http://local.test/apache` â†’ Should load the Apache welcome page
* Visit `http://local.test/custom` â†’ Should load the GitHub website content

---

## âœ… Summary of Commands

```bash
# Deploy Apache
kubectl apply -f apache-deployment.yaml
kubectl apply -f apache-service.yaml

# Clone and containerize custom app
git clone https://github.com/hshar/website.git
cd website
docker build -t yourdockerhubusername/website-app .
docker push yourdockerhubusername/website-app

# Deploy custom app
kubectl apply -f custom-deployment.yaml
kubectl apply -f custom-service.yaml

# Setup ingress
kubectl apply -f ingress.yaml
```

---

## âœ… Directory/File Structure

```
.
â”œâ”€â”€ apache-deployment.yaml
â”œâ”€â”€ apache-service.yaml
â”œâ”€â”€ custom-deployment.yaml
â”œâ”€â”€ custom-service.yaml
â”œâ”€â”€ ingress.yaml
â””â”€â”€ website/
    â””â”€â”€ Dockerfile
```

---
